{% load i18n fobi_tags %}
<div class="page-header">
  <h1>{% trans "Edit form wizard" %}</h1>
</div>

<div class="row">
  <div class="col-12 col-sm-12 col-lg-12">
    <div class="card">
      <div class="card-header">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs card-header-tabs" role="tablist">
            <li class="nav-item"><button class="nav-link active" role="tab" data-bs-toggle="tab" type="button" data-bs-target="#tab-form-elements" aria-controls="tab-form-elements" aria-selected="true">{% trans "Elements" %}</button></li>
            <li class="nav-item"><button class="nav-link" role="tab" data-bs-toggle="tab" type="button" data-bs-target="#tab-form-handlers" aria-controls="tab-form-handlers" aria-selected="false">{% trans "Handlers" %}</button></li>
            <li class="nav-item"><button class="nav-link" role="tab" data-bs-toggle="tab" type="button" data-bs-target="#tab-form-properties" aria-controls="tab-form-properties" aria-selected="false">{% trans "Properties" %}</button></li>
            <li class="nav-item"><button class="nav-link" role="tab" data-bs-toggle="tab" type="button" data-bs-target="#tab-form-service" aria-controls="tab-form-service" aria-selected="false">{% trans "Service" %}</button></li>
        </ul>
      </div>

      <!-- Tab panes -->
      <div class="tab-content">

        <!-- Form element plugins -->
        <div class="tab-pane card-body active" id="tab-form-elements">
          <ul class="nav float-end">
            <li class="dropdown">
              <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                {% trans "Choose form to add" %}
              </button>
              <ul class="dropdown-menu">
                {% for form_entry in all_form_entries %}
                <li><a class="dropdown-item" href="{% url 'fobi.add_form_wizard_form_entry' form_wizard_entry.pk form_entry.pk %}">{{ form_entry.name }}</a></li>
                {% endfor %}
              </ul>
            </li>
          </ul>
          <h2 id="form_elements">{% trans "Add forms to your form wizard" %}</h2>

          <form id="fobi-form" method="post" action="{{ request.path }}?active_tab=tab-form-elements" novalidate="novalidate" class="{% block form_elements_html_class %}form-horizontal ui-sortable{% endblock %}">
            {% csrf_token %}
            <div class="well well-sm">
                {% blocktrans %}Fields marked with <span class="required-field">*</span> are required{% endblocktrans %}
            </div>
            {% for form_wizard_form_entry in form_wizard_entry_forms %}
                <div class="form-group">
                  <label class="col-sm-3 control-label" for="id_form-{{ forloop.counter0 }}-position">{#{ forloop.counter }#}</label>

                  <div class="col-sm-9">
                    {{ form_wizard_form_entry.form_entry.name }}
                    <span class="help-block">
                      <input id="id_form-{{ forloop.counter0 }}-position" min="0" name="form-{{ forloop.counter0 }}-position" type="hidden" value="{{ form_wizard_form_entry.position }}" class="form-element-position" />
                      <input id="id_form-{{ forloop.counter0 }}-id" name="form-{{ forloop.counter0 }}-id" type="hidden" value="{{ form_wizard_form_entry.pk }}" />
                      <div class="{{ fobi_theme.form_list_container_class }}">
                        <a class="btn btn-outline-secondary btn-sm" href="{% url 'fobi.view_form_entry' form_wizard_form_entry.form_entry.slug %}">
                          <i class="{{ fobi_theme.form_view_form_entry_option_class }}"></i> {% trans "View" %}
                        </a>
                        <a class="btn btn-outline-secondary btn-sm" href="{% url 'fobi.edit_form_entry' form_wizard_form_entry.form_entry.pk %}">
                          <i class="{{ fobi_theme.form_edit_form_entry_option_class }}"></i> {% trans "Edit" %}
                        </a>
                        <a class="btn btn-outline-secondary btn-sm" href="{% url 'fobi.delete_form_wizard_form_entry' form_wizard_form_entry.pk %}">
                          <i class="{{ fobi_theme.form_delete_form_entry_option_class }}"></i> {% trans "Delete" %}
                        </a>
                      </div>
                    </span>

                  </div>
                </div>
              {#% include fobi_theme.form_edit_snippet_template_name %#}
            {% endfor %}
            {#{ form_wizard_form_entry_formset.as_p }#}

            {{ form_wizard_form_entry_formset.management_form }}

            <div class="{% block form_elements_button_outer_wrapper_html_class %}control-group d-flex justify-content-end{% endblock %}">
              <div class="{% block form_elements_button_wrapper_html_class %}controls{% endblock %}">
                <input type="submit" name="ordering" class="{% block form_elements_button_html_class %}btn btn-primary{% endblock %}" value="{% trans 'Save ordering' %}"/>
              </div>
            </div>
          </form>
        </div>

        <!-- Form handler plugins -->
        <div class="tab-pane card-body" id="tab-form-handlers">
          <ul class="nav float-end">
            <li class="dropdown">
              <button class="btn btn-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                {% trans "Choose form wizard handler to add" %}
              </button>
              <ul class="dropdown-menu">
                {% for form_wizard_handler_uid, form_wizard_handler_name in user_form_wizard_handler_plugins %}
                <li><a class="dropdown-item" href="{% url 'fobi.add_form_wizard_handler_entry' form_wizard_entry.pk form_wizard_handler_uid %}">{{ form_wizard_handler_name }}</a></li>
                {% endfor %}
              </ul>
            </li>
          </ul>
          <h2 id="form_handlers">{% trans "Add handlers to your form wizard" %}</h2>
          <div class="clearfix"></div>

          {% if form_wizard_handlers %}
          <table class="table table-striped">
            <thead>
              <tr>
                <th>{% trans "Handler" %}</th>
                {#<th>{% trans "Settings" %}</th>#}
                <th>{% trans "Actions" %}</th>
              </tr>
            </thead>
            <tbody>
            {% for form_wizard_handler in form_wizard_handlers %}
              {% with form_wizard_handler.get_plugin as plugin %}
                {% if plugin %}
              <tr>
                <td>{{ form_wizard_handler.plugin_name }}
                  {% if form_wizard_handler.plugin_data or plugin.plugin_data_repr %}
                  <a class="popover-link" data-bs-toggle="popover" data-bs-content="{% spaceless %}{{ plugin.plugin_data_repr|safe }}{% endspaceless %}" role="button">
                    <span class="badge rounded-pill text-bg-secondary" title="{% trans 'Info' %}">?</span>
                  </a>
                  {% endif %}
                </td>
                <td>
                  <ul class="list-inline">
                    {% if form_wizard_handler.plugin_data %}
                    <li><a href="{% url 'fobi.edit_form_wizard_handler_entry' form_wizard_handler.pk %}"><span class="bi bi-pencil"></span> {% trans "Edit" %}</a></li>
                    {% endif %}
                    <li><a href="{% url 'fobi.delete_form_wizard_handler_entry' form_wizard_handler.pk %}"><span class="bi bi-trash"></span> {% trans "Delete" %}</a></li>
                    {% get_fobi_form_wizard_handler_plugin_custom_actions plugin form_wizard_entry as form_wizard_handler_plugin_custom_actions %}
                    {#% for action in plugin.get_custom_actions %#}
                    {% for action in form_wizard_handler_plugin_custom_actions %}
                    <li><a href="{{ action.0 }}"><span class="{{ action.2 }}"></span> {{ action.1 }}</a></li>
                    {% endfor %}
                  </ul>
                </td>
              </tr>
                {% endif %}
              {% endwith %}
            {% endfor %}
            </tbody>
          </table>
          {% endif %}
        </div>

        <!-- Form properties -->
        <div class="tab-pane card-body" id="tab-form-properties">
          <h2 id="form_properties">{% trans "Form wizard properties" %}</h2>

          <form method="post" action="{{ request.path }}?active_tab=tab-form-properties" enctype="multipart/form-data" class="{% block form_properties_html_class %}form-horizontal{% endblock %}">
            {% csrf_token %}
            {% include fobi_theme.form_wizard_properties_snippet_template_name %}

            <div class="{% block form_properties_button_outer_wrapper_html_class %}control-group d-flex justify-content-end{% endblock %}">
              <div class="{% block form_properties_button_wrapper_html_class %}controls{% endblock %}">
                <input type="submit" class="{% block form_properties_button_html_class %}btn btn-primary{% endblock %}" value="{% trans 'Submit changes' %}"/>
              </div>
            </div>
          </form>
        </div>

        <!-- Form service -->
        <div class="tab-pane card-body" id="tab-form-service">
          <h2 id="form_delete">{% trans "Service" %}</h2>
          <div>
            <h3>{% trans "Export your form wizard as JSON" %}</h3>
            <p>{% trans "Export your form into JSON format and import it again any time!" %}</p>
            <p>
              <a class="btn btn-primary" href="{% url 'fobi.export_form_wizard_entry' form_wizard_entry.pk %}" role="button">
                <span class="glyphicon glyphicon-export"></span> {% trans "Export form wizard" %}
              </a>
            </p>
          </div>
          <div>
            <h3>{% trans "Delete your form wizard" %}</h3>
            <p>{% trans "Once deleted, can't be undone!" %}</p>
            <p>
              <a class="btn btn-primary" href="{% url 'fobi.delete_form_wizard_entry' form_wizard_entry.pk %}" role="button">
                <span class="bi bi-trash"></span> {% trans "Delete form wizard" %}
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="col-4 col-sm-4 col-lg-4">




  </div>

</div>